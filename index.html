<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BITEL KMZ extractor for informative letters</title>

  <!-- Performance hints -->
  <link rel="preconnect" href="https://unpkg.com">
  <link rel="dns-prefetch" href="https://unpkg.com">

  <!-- CSS -->
  <link rel="stylesheet" href="css/styles.css?v=2">
</head>
<body>
  <div class="page">
    <div id="loadingOverlay" aria-hidden="true">
      <div>
        <div class="loader"></div>
        <div class="loader-text" id="overlayText">Procesando…</div>
      </div>
    </div>

    <header class="hero">
      <img src="img/bitel_logo.png" class="logo" alt="bitel">
      <h1>KMZ extractor + CAD drawer</h1>
    </header>

    <!-- Barra principal -->
    <div class="bar">
      <label class="pill">Archivo:
        <input id="file" type="file" accept=".kmz,.kml" />
      </label>
      <button id="btn" class="btn accent">Procesar</button>
      <button id="cancel" class="btn danger" disabled>Cancelar</button>
    </div>

    <!-- Card: Progresos y estado -->
    <div class="card">
      <div class="row" style="gap:20px; align-items:flex-end; flex-wrap:wrap;">
        <div style="flex:1 1 260px; min-width:260px;">
          <div class="muted">Subiendo: <b><span id="upPct">0%</span></b></div>
          <div class="progress"><div id="upBar" class="barline"></div></div>
        </div>

        <div style="flex:1 1 260px; min-width:260px;">
          <div class="muted">Procesando en servidor:</div>
          <div class="progress"><div id="procBar" class="barline indeterminate" style="display:none;"></div></div>
        </div>

        <div style="flex:1 1 260px; min-width:260px;">
          <div class="muted">Descargando: <b><span id="downPct">0%</span></b></div>
          <div class="progress"><div id="downBar" class="barline"></div></div>
        </div>
      </div>

      <div id="status" class="muted" style="margin-top:10px;"></div>
      <pre id="log" style="display:none"></pre>
    </div>

    <!-- Sección de conversión (abajo) -->
    <div class="card">
      <h3 style="margin:6px 0 12px;">Conversión a PDF / DXF</h3>
      <div class="row">
        <label class="pill">Subir KMZ/KML(opcional):
          <input id="convFile" type="file" accept=".kmz,.kml" />
        </label>

        <label class="pill">Salida:
          <select id="convFormat">
            <option value="both" selected>Ambos (ZIP)</option>
            <option value="pdf">PDF</option>
            <option value="dwg">DWG</option>
          </select>
        </label>

        <button id="btnConvert" class="btn">Convertir a PDF/DXF</button>
      </div>
      <div class="hint" id="convHint" style="margin-top:8px;">
        Por defecto utiliza el KMZ exportado del paso anterior, caso contrario cargar un KMZ/KML.
      </div>
    </div>
  </div>

  <!-- JS (primero config.js, luego app.js) -->
  <script src="js/config.js"></script>
  <script src="https://unpkg.com/jszip@3.10.1/dist/jszip.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="js/app.js?v=1"></script>
</body>
</html>
